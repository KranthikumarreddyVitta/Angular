<ng-template #dialog>
  <div class="dialog" fxLayout="column" fxLayoutAlign="center stretch">
    <div fxLayout="row" style="width: 100%" fxLayoutAlign="space-between start">
      <div class="h2" style="margin-bottom: 2rem">Add a Moodboard</div>
      <button mat-flat-button mat-dialog-close>
        <i class="fa fa-times" aria-hidden="true"></i>
      </button>
    </div>
    <mat-dialog-content>
      <div fxLayout="column" fxLayoutGap="1rem">
        <mat-label>Select a Moodboard to be added to this quote.</mat-label>
        <mat-form-field appearance="outline">
          <mat-select
            [(ngModel)]="selectedMoodboard"
            (selectionChange)="selectionChange()"
          >
            <ng-container *ngFor="let moodboard of moodboardList">
              <mat-option [value]="moodboard.sgid">{{
                moodboard.boardname
              }}</mat-option>
            </ng-container>

            <mat-option *ngIf="moodboardList.length === 0" value=""
              >No Moodboard</mat-option
            >
          </mat-select>
        </mat-form-field>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions fxLayout="row" fxLayoutAlign="center center">
      <button
        class="round"
        mat-flat-button
        color="accent"
        [disabled]="!selectedMoodboard"
        (click)="addMoodboard(selectedMoodboard)"
      >
        Add Moodboard
      </button>
    </mat-dialog-actions>
  </div>
</ng-template>

<div class="quote" fxLayout="column" fxLayoutAlign=" stretch">
  <div class="quote-details" fxLayout="row" fxLayoutAlign=" stretch">
    <div
      class="quote-details__icon"
      fxFlex="30"
      fxLayout="column"
      fxLayoutAlign="center center"
    >
      <span>{{ text }}</span>
      <img [src]="iconPath" alt="" srcset="" />
    </div>
    <div
      class="quote-details__info"
      fxFlex="60"
      fxLayout="row wrap"
      fxLayoutAlign="start"
    >
      <div fxFlex="66" *ngIf="quoteDetails?.order_reference">
        <span class="label">Order Number: </span>
        <span class="value">{{ quoteDetails.order_reference }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Project Name: </span>
        <span class="value">{{ quoteDetails.project_name }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Company Name: </span>
        <span class="value">{{ quoteDetails.company_name }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Address: </span>
        <span class="value">{{ quoteDetails.address }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Quote #: </span>
        <span class="value">{{ quoteDetails.sgid }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Contact No: </span>
        <span class="value">{{ quoteDetails.contactno }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">State: </span>
        <span class="value">{{ quoteDetails.is_state_name }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Customer Name: </span>
        <span class="value">{{ quoteDetails.name }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Email: </span>
        <span class="value">{{ quoteDetails.email }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">City: </span>
        <span class="value">{{ quoteDetails.city_name }}</span>
      </div>
      <div fxFlex="33">
        <span class="label">Zipcode: </span>
        <span class="value">{{ quoteDetails.is_zip_code }}</span>
      </div>
    </div>
    <div
      class="quote-details__copy"
      fxFlex="10"
      fxLayout="row"
      fxLayoutAlign="start end"
      fxLayoutGap="1rem"
    >
      <button
        mat-mini-fab
        color="accent"
        aria-label="Example icon button with a filter list icon"
        (click)="OnCopy($event)"
      >
        <mat-icon>file_copy</mat-icon>
      </button>
      <button
        mat-mini-fab
        *ngIf="text === 'QUOTE' && editQuote"
        color="accent"
        (click)="OnEdit($event)"
      >
        <mat-icon>edit icon</mat-icon>
      </button>
    </div>
  </div>
  <mat-tab-group
    color="accent"
    class="tabs"
    (selectedTabChange)="onTabChanged($event)"
    mat-align-tabs="start"
  >
    <mat-tab label="Default Unit">
      <div fxLayout="column" class="tabs-item">
        <div class="quote-moodboard" fxLayout="column" fxLayoutAlign=" stretch">
          <div
            class="quote-moodboard__list"
            fxLayout="row wrap"
            fxLayoutAlign="start"
            fxLayoutGap="1rem"
          >
            <div
              fxFlex="10"
              class="quote-moodboard__list--item moodboard-list"
              [ngClass]="{ selected: moodboard.sgid == selectedQuoteMD.sgid }"
              *ngFor="let moodboard of quoteMDList"
              fxLayout="column"
            >
              <img
                height="110px"
                width="auto"
                (click)="onClickMDorProduct(moodboard)"
                [src]="moodboard?.unitmoodboards?.is_moodboard_images?.small"
                alt="Moodboard"
              />
              <p>{{ moodboard?.unitmoodboards?.boardname }}</p>
            </div>
            <div
              fxFlex="10"
              class="quote-moodboard__list--item moodboard-list"
              [ngClass]="{ selected: product.sgid == selectedQuoteMD.sgid }"
              *ngFor="let product of quoteIPList"
              fxLayout="column"
            >
              <img
                height="110px"
                width="auto"
                (click)="onClickMDorProduct(product)"
                [src]="
                  product?.variation_new?.default_images[0]?.image_url?.small
                "
                alt="Moodboard"
              />
              <p>{{ product.name }}</p>
            </div>
            <div
              fxFlex="10"
              class="quote-moodboard__list--item"
              fxLayoutAlign="center center"
              fxLayout="column"
              (click)="openDialog()"
              *ngIf="text === 'QUOTE' && editQuote"
            >
              <mat-icon class="icon" inline="true">add_circle_outline</mat-icon>
            </div>
          </div>
        </div>
        <div fxFlex="row" *ngIf="selectedQuoteMD" class="quote-moodboard--sec">
          <div
            fxLayout="column"
            fxFlex="20"
            fxLayoutGap="1rem"
            fxLayoutAlign="center center"
          >
            <div class="h2">
              {{
                selectedQuoteMD?.isIndividual
                  ? selectedQuoteMD?.name
                  : selectedQuoteMD?.unitmoodboards?.boardname
              }}
            </div>
            <button
              class="round"
              mat-flat-button
              (click)="addMDtoFloorPlan()"
              color="accent" *ngIf = "routeIndex == 1"
            >
              ADD TO FLOORPLAN
            </button>
            <button
              class="round"
              mat-flat-button
              (click)="addMDtoUnit()"
              color="accent" *ngIf = "routeIndex == 1"
            >
              ADD TO UNIT
            </button>
            <button
              class="round"
              *ngIf="!selectedQuoteMD?.isIndividual && routeIndex == 1"
              mat-flat-button
              (click)="removeMDfromQuote()"
              color="primary" 
            >
              REMOVE MOODBOARD
            </button>
            <button
              
              class="round"
              *ngIf="selectedQuoteMD?.isIndividual && routeIndex == 1"
              mat-flat-button
              color="primary" 
              (click)="removeProductfromQuote()"
            >
              REMOVE PRODUCT
            </button>
            <button
              class="round"
              *ngIf="!selectedQuoteMD?.isIndividual && routeIndex == 1"
              mat-flat-button
              color="primary"
              (click)="goToMoodboard()"
            >
              GO TO MOODBOARD
            </button>
          </div>
          <mat-divider style="margin-right: 4rem" vertical="true"></mat-divider>
          <div
            fxFlex
            class="quote- sec"
            fxLayout="row"
            fxLayoutGap="3rem"
            fxLayoutAlign="start"
          >
            <div
              fxFlex="22"
              class="quote-moodboard__list--item moodboard-list"
              *ngFor="let item of moodboardItems"
              fxLayout="column"
              fxLayoutGap=".5rem"
              fxLayoutAlign="start"
            >
              <lib-item-type
                style="width: 65px"
                [status]="item?.button_type"
              ></lib-item-type>
              <div fxFlex fxLayoutAlign="center center" fxLayout="column">
                <img
                  fxFlex
                  height="100px"
                  width="90px"
                  [src]="item?.variation?.images[0]?.image_url?.small"
                  alt="Moodboard"
                />
                <p class="h3">{{ item?.name }}</p>
                <p>
                  {{ "Qty :" + item?.qty }}
                </p>
              </div>
            </div>
            <div
              fxFlex="22"
              class="quote-moodboard__list--item moodboard-list"
              *ngIf="selectedQuoteMD?.isIndividual"
              fxLayout="column"
              fxLayoutGap=".5rem"
              fxLayoutAlign="start"
            >
              <lib-item-type
                style="width: 65px"
                [status]="selectedQuoteMD?.button_type"
              ></lib-item-type>
              <div fxFlex fxLayoutAlign="center center" fxLayout="column">
                <img
                  fxFlex
                  height="100px"
                  width="90px"
                  [src]="
                    selectedQuoteMD?.variation_new?.default_images[0]?.image_url
                      ?.small
                  "
                  alt="Moodboard"
                />
                <p class="h3">{{ selectedQuoteMD?.name }}</p>
                <p>
                  {{ "Qty :" + selectedQuoteMD?.qty }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
    <mat-tab label="Floor Plans">
      <div class="g-box-shadow tabs-item fp">
        <span *ngIf="floorPlanList.length <= 0" class="fp__default-text"
          >No Floor Plans found. Please add Floor Plan.</span
        >
        <div fxLayout="row wrap" fxLayoutGap="2rem" class="fp__container">
          <div
            *ngFor="let fp of floorPlanList"
            fxLayout="column"
            fxLayoutGap="1rem"
            class="g-box-shadow fp__container--item"
          >
            <span
              fxLayout="row"
              fxLayoutGap="1rem"
              fxLayoutAlign="center center"
            >
              <button
                class="round"
                (click)="removeFloorPlanFromQuote(fp)"
                *ngIf="removeFloorPlanFlag"
                mat-flat-button
              >
                <i class="fa fa-times-circle-o" aria-hidden="true"></i> Remove
              </button>
              <button
                *ngIf="!removeFloorPlanFlag"
                class="icon-button"
                mat-icon-button
                disabled
                aria-label="Example icon button with a filter list icon"
              >
                <mat-icon>file_copy</mat-icon>
              </button>
              <button
                *ngIf="!removeFloorPlanFlag"
                class="icon-button"
                mat-icon-button
                disabled
                aria-label="Example icon button with a filter list icon"
              >
                <mat-icon>edit icon</mat-icon>
              </button>
            </span>
            <span fxLayout="column" style="align-items: center">
              <span class="h2">{{ fp.floorname }}</span>
              <span>{{ fp.floorplan_mb_cnt }} Moodboard</span>
              <span> {{ fp.total_unit }} Units</span>
              <span> {{ fp.floorplan_type_name }}</span>
            </span>
            <button class="round" (click)="openFloorPlanPage(fp)" mat-flat-button color="accent">
              SETUP
            </button>
          </div>
        </div>
        <div fxLayout="row" fxLayoutGap="2rem">
          <button
            class="round"
            *ngIf="!removeFloorPlanFlag"
            mat-flat-button
            color="primary"
            (click)="openAddFloorPlanDialog()"
          >
            ADD FLOOR PLAN
          </button>
          <button
            class="round"
            (click)="removeFloorPlanFlag = !removeFloorPlanFlag"
            mat-flat-button
            color="primary"
          >
            {{ removeFloorPlanFlag ? "CANCEL" : "REMOVE FLOOR PLAN" }}
          </button>
        </div>
      </div>
    </mat-tab>
    <mat-tab label="Floor plan Units">
      <div class="g-box-shadow tabs-item fpu">
        <span *ngIf="floorPlanList.length <= 0" class="fpu__default-text">
          No Floor Plans found. Please add Floor Plan.
        </span>
        <div class="fpu__container g-box-shadow" *ngFor="let fp of unitList?.FloorPlanWithUnits">
          <span class="h2">{{ fp?.floorname }}</span>
          <div fxLayout="row" fxLayoutGap="1rem">
            <div
              fxLayout="column"
              *ngFor="let unit of fp.unit_ids"
              class="fpu__container--unit g-box-shadow pointer"
              (click)="openFloorPlanUnit(unit.name)"
            >
              <button disabled mat-flat-button>
                <i
                  *ngIf="removeUnitFlag"
                  class="fa fa-times"
                  aria-hidden="true"
                ></i>
              </button>
              <div class="h2">{{ unit.name }}</div>
              <div class="h3">Unit</div>
            </div>
          </div>
        </div>
        <div class="fpu__container g-box-shadow" >
          <!-- <span class="h2">{{ fp?.floorname }}</span> -->
          <div fxLayout="row" fxLayoutGap="1rem">
            <div
              fxLayout="column"
              *ngFor="let unit of unitList?.UnitsWithoutFloorPlan"
              class="fpu__container--unit g-box-shadow"
            >
              <button disabled mat-flat-button>
                <i
                  *ngIf="removeUnitFlag"
                  class="fa fa-times"
                  aria-hidden="true"
                ></i>
              </button>
              <div class="h2">{{ unit.name }}</div>
              <div class="h3">Unit</div>
            </div>
          </div>
        </div>
        <div fxLayout="row" fxLayoutGap="2rem">
          <button
            class="round"
            mat-flat-button
            *ngIf="!removeUnitFlag"
            (click)="openAddUnitDialog()"
            color="primary"
          >
            ADD UNIT(S)
          </button>
          <button
            class="round"
            mat-flat-button
            (click)="removeUnitFromFP()"
            color="primary"
          >
            {{ removeUnitFlag ? "CANCEL" : "REMOVE UNIT(S)" }}
          </button>
          <span fxFlex></span>
          <mat-checkbox disabled color="accent"> UNASSIGNED</mat-checkbox>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>

  <div class="quote-summary" fxLayout="column" fxLayoutAlign="start stretch">
    <div
      class="quote-summary__info"
      fxLayout="row"
      fxLayoutAlign="start start"
      fxLayoutGap="2rem"
    >
      <div>
        <span class="quote-summary__info--label">Customer City :</span>
        <span class="quote-summary__info--value">
          {{ quoteDetails.city_name }}</span
        >
      </div>
      <div>
        <span class="quote-summary__info--label">Zipcode:</span>
        <span class="quote-summary__info--value">{{
          quoteDetails.is_zip_code
        }}</span>
      </div>
    </div>
    <ag-grid-angular
      [gridOptions]="gridOptions"
      style="height: 600px; width: 100%"
      class="ag-theme-alpine quotes-table"
      [rowData]="rowData | async"
      [frameworkComponents]="frameworkComponents"
      [pinnedBottomRowData]="pinnedBottomRowData"
      [defaultColDef]="defaultColDef"
      [columnDefs]="columnDefs"
    >
    </ag-grid-angular>
    <div
      class="quote-summary__actions"
      fxLayout="row"
      fxLayoutAlign="center"
      fxLayoutGap="2rem"
    >
      <ng-content [select]="actions"> </ng-content>
    </div>
  </div>
</div>
